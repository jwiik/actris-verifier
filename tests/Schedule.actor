actor FairMerge int x1, int x2 ==> int y :
  a1: action x1:[i] ==> y:[i] end
  a2: action x2:[i] ==> y:[i] end
  
  schedule fsm s1:
    s1 (a1) --> s2;
    s2 (a2) --> s1;
  end
end

network Top int in1, int in2 ==> int out :
  action in1:[i], in2:[j] ==> out:[i,j] end
  
  invariant state(fm,s1)
  
  chinvariant tot(c) == rd(a)+rd(b)
  chinvariant tot(c) >= 1 ==> urd(a) == 0
  chinvariant tot(c) >= 2 ==> urd(b) == 0
  chinvariant rd(a) == 0 && rd(b) == 0 ==> state(fm,s1)
  chinvariant rd(a) == 1 && rd(b) == 0 ==> state(fm,s2)
  chinvariant rd(a) == 1 && rd(b) == 1 ==> state(fm,s1)

  chinvariant tot(c) >= 1 ==> c[0] == a[0]
  chinvariant tot(c) >= 2 ==> c[1] == b[0]

  entities
    fm = FairMerge();
  end
  structure
    a: in1 --> fm.x1;
    b: in2 --> fm.x2;
    c: fm.y --> out;
  end
end