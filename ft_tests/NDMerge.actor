actor NonDetMerge int x1, int x2 ==> int y :

  stream invariant tot(y) = rd(x1)+rd(x2)

  a1: action x1:[i] ==> y:[i] end
  a2: action x2:[i] ==> y:[i] end
  
end

network Top int in1, int in2 ==> int out :
  
  action in1:1 ==> out:1
    ensures out[@] = in1[@]
  end
  
  action in2:1 ==> out:1 
    ensures out[@] = in2[@]
  end
  
  chinvariant tot@(c) > 0 && rd@(b) = 0 ==> c[@] = a[@]
  chinvariant tot@(c) > 0 && rd@(a) = 0 ==> c[@] = b[@]
  chinvariant rd@(in1)+rd@(in2) = tot@(out)
    
  entities
    ndm = NonDetMerge();
  end
  structure
    a: in1 --> ndm.x1;
    b: in2 --> ndm.x2;
    c: ndm.y --> out;
  end
end